/*
*******************************************************************************************************
*
* File Name : luenberger.h
* Version   : V1.0
* Author    : mzy2364
* brief     : PMSM Luenberger control file
* 
*******************************************************************************************************
*/

#ifndef _LUENBERGER_H
#define _LUENBERGER_H

#ifdef __cplusplus
extern "C"{
#endif

/*==================================================================================================
*                                        INCLUDE FILES
* 1) system and project includes
* 2) needed interfaces from external units
* 3) internal and external interfaces from this unit
==================================================================================================*/
#include <stdint.h>
#include "foc.h"

/*==================================================================================================
*                              SOURCE FILE VERSION INFORMATION
==================================================================================================*/


/*==================================================================================================
*                                          CONSTANTS
==================================================================================================*/


/*==================================================================================================
*                                      DEFINES AND MACROS
==================================================================================================*/
#ifndef ABS
#define ABS(x)                    (((x)<0)? (-(x)):(x))
#endif

/*==================================================================================================
*                                             ENUMS
==================================================================================================*/
/**
* @brief          
* @details        
*/


/*==================================================================================================
*                                STRUCTURES AND OTHER TYPEDEFS
==================================================================================================*/
typedef struct{
    float C1;       //Ts/Ls
    float C2;       //1-(Rs*Ts/Ls)
    float C3;       //h1*Ts
    float C4;       //h2*Ts
    float valpha;   //实际输出电压vα
    float vbeta;    //实际输出电压vβ
    float ialpha;   //实际电流iα
    float ibeta;    //实际电流iβ
    float ialpha_est;       //估算的iα
    float ibeta_est;        //估算的iβ
    float ealpha_est;       //估算的eα
    float ebeta_est;        //估算的eβ
    float theta;            //估算的角度 0-2PI
    float omega;            //估算的速度 rad/s
    pid_control_t pll_pi_regulator;
}sto_luenberger_t;


/*==================================================================================================
*                                GLOBAL VARIABLE DECLARATIONS
==================================================================================================*/


/*==================================================================================================
*                                    FUNCTION PROTOTYPES
==================================================================================================*/
void sto_luenberger_init(sto_luenberger_t *s);
void sto_luenberger_estimation(sto_luenberger_t *s);

#ifdef __cplusplus
}
#endif

#endif /* _SMCPOS_H */

/************************************************EOF************************************************/
