/*
*******************************************************************************************************
*
* File Name : ntc.c
* Version   : V1.0
* Author    : mzy2364
* brief     : ntc table
* 
*******************************************************************************************************
*/


/* INCLUDE FILES ------------------------------------------------------------------------------------*/
#include "adc_simple.h"

/* DEFINES ------------------------------------------------------------------------------------------*/
#define NTC_TABLE_LEN   176

/* VARIABLES ----------------------------------------------------------------------------------------*/
int16_t ntc_table[NTC_TABLE_LEN][2] = {
{-50,4038},
{-49,4033},
{-48,4029},
{-47,4024},
{-46,4019},
{-45,4013},
{-44,4007},
{-43,4001},
{-42,3995},
{-41,3988},
{-40,3980},
{-39,3972},
{-38,3964},
{-37,3955},
{-36,3946},
{-35,3936},
{-34,3926},
{-33,3915},
{-32,3904},
{-31,3892},
{-30,3880},
{-29,3866},
{-28,3853},
{-27,3838},
{-26,3823},
{-25,3807},
{-24,3790},
{-23,3773},
{-22,3755},
{-21,3736},
{-20,3716},
{-19,3696},
{-18,3674},
{-17,3652},
{-16,3629},
{-15,3605},
{-14,3580},
{-13,3554},
{-12,3528},
{-11,3500},
{-10,3472},
{-9,3442},
{-8,3412},
{-7,3381},
{-6,3349},
{-5,3316},
{-4,3282},
{-3,3247},
{-2,3212},
{-1,3175},
{0,3138},
{1,3100},
{2,3061},
{3,3022},
{4,2982},
{5,2941},
{6,2899},
{7,2857},
{8,2815},
{9,2771},
{10,2728},
{11,2684},
{12,2639},
{13,2595},
{14,2550},
{15,2504},
{16,2459},
{17,2413},
{18,2367},
{19,2321},
{20,2276},
{21,2230},
{22,2184},
{23,2139},
{24,2093},
{25,2048},
{26,2003},
{27,1959},
{28,1914},
{29,1870},
{30,1827},
{31,1784},
{32,1741},
{33,1699},
{34,1658},
{35,1617},
{36,1577},
{37,1537},
{38,1498},
{39,1459},
{40,1421},
{41,1384},
{42,1348},
{43,1312},
{44,1277},
{45,1243},
{46,1209},
{47,1176},
{48,1144},
{49,1112},
{50,1082},
{51,1052},
{52,1022},
{53,994},
{54,966},
{55,938},
{56,912},
{57,886},
{58,861},
{59,836},
{60,812},
{61,789},
{62,766},
{63,744},
{64,723},
{65,702},
{66,682},
{67,662},
{68,643},
{69,624},
{70,606},
{71,589},
{72,572},
{73,555},
{74,539},
{75,524},
{76,509},
{77,494},
{78,480},
{79,466},
{80,453},
{81,440},
{82,427},
{83,415},
{84,403},
{85,392},
{86,381},
{87,370},
{88,360},
{89,349},
{90,340},
{91,330},
{92,321},
{93,312},
{94,303},
{95,295},
{96,287},
{97,279},
{98,271},
{99,264},
{100,256},
{101,249},
{102,243},
{103,236},
{104,230},
{105,223},
{106,217},
{107,212},
{108,206},
{109,200},
{110,195},
{111,190},
{112,185},
{113,180},
{114,175},
{115,171},
{116,166},
{117,162},
{118,158},
{119,154},
{120,150},
{121,146},
{122,142},
{123,139},
{124,135},
{125,132}
};


/* FUNCTION -----------------------------------------------------------------------------------------*/

/**
 * 使用NTC查表计算温度
 * @param ntc_adc NTC对应的ADC采集值
 * @return 温度值，单位为摄氏度
 */
float calculate_temperature_float(uint16_t ntc_adc)
{
	int low = 0;
	int high = NTC_TABLE_LEN - 1;
	while (low <= high)
	{
		int mid = (low + high) / 2;
		if (ntc_adc > ntc_table[mid][1])
		{
			high = mid - 1;
		} 
		else if (ntc_adc < ntc_table[mid][1])
		{
			low = mid + 1;
		} 
		else
		{
			return ntc_table[mid][0];
		}
	}
	// 此时 low 和 high 分别指向最接近 ntc_adc 的两个电阻值
	if (low == 0)
	{
		return ntc_table[0][0];
	}
	else if (high == NTC_TABLE_LEN - 1)
	{
		return ntc_table[NTC_TABLE_LEN - 1][0];
	}
	else
	{
		float x0 = ntc_table[low - 1][0];
		float y0 = ntc_table[low - 1][1];
		float x1 = ntc_table[low][0];
		float y1 = ntc_table[low][1];
		return x0 + (x1 - x0) * (ntc_adc - y0) / (y1 - y0);
	}
}


/* LOCAL FUNCTION -----------------------------------------------------------------------------------*/
/**
  * @brief 
  * @param None
  * @retval None
  */


/***************************************** (END OF FILE) *********************************************/
